{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.2", "generated_at": "2026-01-04T19:24:22.809720Z", "invocation_id": "402658b7-059e-4de5-83c3-55909b7e2657", "invocation_started_at": "2026-01-04T19:24:22.186775Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.528701Z", "completed_at": "2026-01-04T19:24:22.536432Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.537113Z", "completed_at": "2026-01-04T19:24:22.537122Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009688138961791992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.dim_date", "compiled": true, "compiled_code": "/*\n    Model: dim_date\n    Layer: Dimension\n    Description: \n        Date dimension with calendar and fiscal attributes.\n        Role-playing dimension - used for multiple date columns in facts.\n    \n    Problems Addressed:\n    - #8 Fiscal vs Calendar: Both calendar and fiscal attributes\n    - #20 Role-Playing Dimensions: Same dim for request/pickup/dropoff dates\n*/\n\n\n\nwith date_spine as (\n    -- Generate dates from 2020 to 2030\n    select \n        generate_series(\n            '2020-01-01'::date,\n            '2030-12-31'::date,\n            '1 day'::interval\n        )::date as date_day\n),\n\ncalendar_attributes as (\n    select\n        -- Primary key\n        to_char(date_day, 'YYYYMMDD')::integer as date_key,\n        date_day as full_date,\n        \n        -- Calendar attributes\n        extract(year from date_day)::integer as calendar_year,\n        extract(quarter from date_day)::integer as calendar_quarter,\n        extract(month from date_day)::integer as calendar_month,\n        extract(week from date_day)::integer as calendar_week,\n        extract(day from date_day)::integer as day_of_month,\n        extract(dow from date_day)::integer as day_of_week,  -- 0=Sunday\n        extract(doy from date_day)::integer as day_of_year,\n        \n        -- Names\n        to_char(date_day, 'Month') as month_name,\n        to_char(date_day, 'Mon') as month_short_name,\n        to_char(date_day, 'Day') as day_name,\n        to_char(date_day, 'Dy') as day_short_name,\n        \n        -- Quarters\n        'Q' || extract(quarter from date_day)::varchar as quarter_name,\n        extract(year from date_day)::varchar || '-Q' || extract(quarter from date_day)::varchar as year_quarter,\n        \n        -- ISO week (Mon-Sun) for payout periods\n        extract(isoyear from date_day)::integer as iso_year,\n        extract(week from date_day)::integer as iso_week,\n        \n        -- Week boundaries (for driver payouts - Mon to Sun)\n        date_trunc('week', date_day)::date as week_start_date,\n        (date_trunc('week', date_day) + interval '6 days')::date as week_end_date,\n        \n        -- Month boundaries\n        date_trunc('month', date_day)::date as month_start_date,\n        (date_trunc('month', date_day) + interval '1 month - 1 day')::date as month_end_date,\n        \n        -- Quarter boundaries\n        date_trunc('quarter', date_day)::date as quarter_start_date,\n        (date_trunc('quarter', date_day) + interval '3 months - 1 day')::date as quarter_end_date,\n        \n        -- Flags\n        case when extract(dow from date_day) in (0, 6) then true else false end as is_weekend,\n        case when extract(dow from date_day) = 1 then true else false end as is_monday,\n        case when extract(dow from date_day) = 5 then true else false end as is_friday,\n        \n        -- Relative dates (useful for reporting)\n        date_day = current_date as is_today,\n        date_day = current_date - 1 as is_yesterday,\n        date_day >= date_trunc('week', current_date) and date_day <= current_date as is_current_week,\n        date_day >= date_trunc('month', current_date) and date_day <= current_date as is_current_month\n        \n    from date_spine\n),\n\n-- Add fiscal calendar for different regions\nwith_fiscal as (\n    select\n        c.*,\n        \n        -- US Fiscal (Jan-Dec, same as calendar)\n        c.calendar_year as fiscal_year_us,\n        c.calendar_quarter as fiscal_quarter_us,\n        \n        -- UK/Japan Fiscal (Apr-Mar)\n        case \n            when c.calendar_month >= 4 then c.calendar_year + 1\n            else c.calendar_year\n        end as fiscal_year_uk,\n        case \n            when c.calendar_month >= 4 then ((c.calendar_month - 4) / 3 + 1)::integer\n            else ((c.calendar_month + 8) / 3 + 1)::integer\n        end as fiscal_quarter_uk,\n        \n        -- Australia Fiscal (Jul-Jun)\n        case \n            when c.calendar_month >= 7 then c.calendar_year + 1\n            else c.calendar_year\n        end as fiscal_year_au,\n        case \n            when c.calendar_month >= 7 then ((c.calendar_month - 7) / 3 + 1)::integer\n            else ((c.calendar_month + 5) / 3 + 1)::integer\n        end as fiscal_quarter_au\n        \n    from calendar_attributes c\n)\n\nselect \n    *,\n    -- Audit\n    current_timestamp as _loaded_at\nfrom with_fiscal", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"dim_date\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.534169Z", "completed_at": "2026-01-04T19:24:22.536754Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.537585Z", "completed_at": "2026-01-04T19:24:22.537590Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.009682893753051758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "operation.uber_analytics.uber_analytics-on-run-end-0", "compiled": true, "compiled_code": "", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.531861Z", "completed_at": "2026-01-04T19:24:22.536934Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.537821Z", "completed_at": "2026-01-04T19:24:22.537823Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010040760040283203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.dim_trip_flags", "compiled": true, "compiled_code": "/*\n    Model: dim_trip_flags\n    Layer: Dimension\n    Description: \n        Junk dimension combining low-cardinality trip flags.\n        Reduces fact table width and improves query performance.\n    \n    Problems Addressed:\n    - #25 Junk Dimensions: Combine boolean flags\n*/\n\n\n\n-- Generate all possible combinations of flags using generate_series\nwith bool_values as (\n    select bool_val\n    from (values (true), (false)) as t(bool_val)\n),\n\nflag_combinations as (\n    select\n        s.bool_val as is_surge,\n        p.bool_val as is_pool,\n        pr.bool_val as is_premium,\n        t.bool_val as has_tip,\n        pm.bool_val as has_promo,\n        la.bool_val as is_late_arrival,\n        c.bool_val as is_completed,\n        cn.bool_val as is_cancelled\n    from bool_values s\n    cross join bool_values p\n    cross join bool_values pr\n    cross join bool_values t\n    cross join bool_values pm\n    cross join bool_values la\n    cross join bool_values c\n    cross join bool_values cn\n    -- Filter out impossible combinations\n    where not (c.bool_val and cn.bool_val)\n)\n\nselect\n    -- Junk dimension key\n    \n    md5(\n        \n            coalesce(cast(is_surge as varchar), 'N')\n             || \n        \n            coalesce(cast(is_pool as varchar), 'N')\n             || \n        \n            coalesce(cast(is_premium as varchar), 'N')\n             || \n        \n            coalesce(cast(has_tip as varchar), 'N')\n             || \n        \n            coalesce(cast(has_promo as varchar), 'N')\n             || \n        \n            coalesce(cast(is_late_arrival as varchar), 'N')\n             || \n        \n            coalesce(cast(is_completed as varchar), 'N')\n             || \n        \n            coalesce(cast(is_cancelled as varchar), 'N')\n            \n        \n    )\n as trip_flag_key,\n    \n    -- Individual flags\n    is_surge,\n    is_pool,\n    is_premium,\n    has_tip,\n    has_promo,\n    is_late_arrival,\n    is_completed,\n    is_cancelled,\n    \n    -- Derived descriptions\n    case \n        when is_surge then 'Surge Pricing'\n        else 'Standard Pricing'\n    end as pricing_type,\n    \n    case\n        when is_completed then 'Completed'\n        when is_cancelled then 'Cancelled'\n        else 'Other'\n    end as trip_outcome,\n    \n    -- Flag count (useful for filtering)\n    (is_surge::int + is_pool::int + is_premium::int + \n     has_tip::int + has_promo::int + is_late_arrival::int) as special_flag_count,\n    \n    -- Audit\n    current_timestamp as _loaded_at\n\nfrom flag_combinations", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"dim_trip_flags\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.535155Z", "completed_at": "2026-01-04T19:24:22.537425Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.538229Z", "completed_at": "2026-01-04T19:24:22.538233Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.009979248046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "operation.uber_analytics.uber_analytics-on-run-start-0", "compiled": true, "compiled_code": "", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.540003Z", "completed_at": "2026-01-04T19:24:22.540537Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.542031Z", "completed_at": "2026-01-04T19:24:22.542034Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003161191940307617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.ref_cities", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.540819Z", "completed_at": "2026-01-04T19:24:22.541293Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.542838Z", "completed_at": "2026-01-04T19:24:22.542840Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0036461353302001953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.ref_currencies", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.541453Z", "completed_at": "2026-01-04T19:24:22.541885Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.543045Z", "completed_at": "2026-01-04T19:24:22.543048Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00372314453125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.ref_currency_rates", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.542259Z", "completed_at": "2026-01-04T19:24:22.542698Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.543427Z", "completed_at": "2026-01-04T19:24:22.543430Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0038299560546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.ref_service_types", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.545325Z", "completed_at": "2026-01-04T19:24:22.545799Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.547253Z", "completed_at": "2026-01-04T19:24:22.547256Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.003153085708618164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.ref_trip_status", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.546082Z", "completed_at": "2026-01-04T19:24:22.546525Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.548038Z", "completed_at": "2026-01-04T19:24:22.548041Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0035538673400878906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_drivers", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.546680Z", "completed_at": "2026-01-04T19:24:22.547103Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.548240Z", "completed_at": "2026-01-04T19:24:22.548243Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003607034683227539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_payments", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.547470Z", "completed_at": "2026-01-04T19:24:22.547899Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.548621Z", "completed_at": "2026-01-04T19:24:22.548623Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0037190914154052734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_riders", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.550364Z", "completed_at": "2026-01-04T19:24:22.550865Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.576046Z", "completed_at": "2026-01-04T19:24:22.576052Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.026905059814453125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_surge_snapshots", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.551139Z", "completed_at": "2026-01-04T19:24:22.552426Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.576922Z", "completed_at": "2026-01-04T19:24:22.576925Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02739882469177246, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_trips_driver_app", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.552587Z", "completed_at": "2026-01-04T19:24:22.575780Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.577157Z", "completed_at": "2026-01-04T19:24:22.577160Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.02748394012451172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_trips_rider_app", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.576307Z", "completed_at": "2026-01-04T19:24:22.576772Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.577618Z", "completed_at": "2026-01-04T19:24:22.577622Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02768111228942871, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.uber_analytics.source_vehicles", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.579473Z", "completed_at": "2026-01-04T19:24:22.588951Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.589279Z", "completed_at": "2026-01-04T19:24:22.589291Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011057853698730469, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_date_date_key.881d0a31b6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_date\"\nwhere date_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_date_date_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.584009Z", "completed_at": "2026-01-04T19:24:22.589103Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.589782Z", "completed_at": "2026-01-04T19:24:22.589785Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.011221885681152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_date_full_date.598d7b137c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_date\"\nwhere full_date is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_date_full_date\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.587482Z", "completed_at": "2026-01-04T19:24:22.589516Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.590147Z", "completed_at": "2026-01-04T19:24:22.590150Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011099100112915039, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_date_full_date.fd8739c008", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    full_date as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_date\"\nwhere full_date is not null\ngroup by full_date\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_date_full_date\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.585395Z", "completed_at": "2026-01-04T19:24:22.589643Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.590364Z", "completed_at": "2026-01-04T19:24:22.590366Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.011711835861206055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_date_date_key.0869fd48f9", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    date_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_date\"\nwhere date_key is not null\ngroup by date_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_date_date_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.591985Z", "completed_at": "2026-01-04T19:24:22.597348Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.597542Z", "completed_at": "2026-01-04T19:24:22.597547Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006762981414794922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_trip_flags_trip_flag_key.60cf54cd30", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_trip_flags\"\nwhere trip_flag_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_trip_flags_trip_flag_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.593575Z", "completed_at": "2026-01-04T19:24:22.597770Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.598420Z", "completed_at": "2026-01-04T19:24:22.598423Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00712895393371582, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_trip_flags_trip_flag_key.4c6b742189", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trip_flag_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_trip_flags\"\nwhere trip_flag_key is not null\ngroup by trip_flag_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_trip_flags_trip_flag_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.594806Z", "completed_at": "2026-01-04T19:24:22.597931Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.598639Z", "completed_at": "2026-01-04T19:24:22.598641Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007067203521728516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_cities_city_id.a9d072b3d8", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_cities\"\nwhere city_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_cities_city_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.596048Z", "completed_at": "2026-01-04T19:24:22.598209Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.599006Z", "completed_at": "2026-01-04T19:24:22.599009Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007322072982788086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_cities_currency_code.e2d1566b71", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_cities\"\nwhere currency_code is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_cities_currency_code\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.600197Z", "completed_at": "2026-01-04T19:24:22.605914Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.607234Z", "completed_at": "2026-01-04T19:24:22.607239Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008415937423706055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_cities_timezone.bf1e4e90cf", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_cities\"\nwhere timezone is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_cities_timezone\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.604705Z", "completed_at": "2026-01-04T19:24:22.607523Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.608153Z", "completed_at": "2026-01-04T19:24:22.608156Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008116960525512695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_currencies_currency_code.313f6ae64f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_currencies\"\nwhere currency_code is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_currencies_currency_code\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.603249Z", "completed_at": "2026-01-04T19:24:22.607663Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.608377Z", "completed_at": "2026-01-04T19:24:22.608380Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008471250534057617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_ref_cities_city_id.79519881a6", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    city_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"ref_cities\"\nwhere city_id is not null\ngroup by city_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_ref_cities_city_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.606045Z", "completed_at": "2026-01-04T19:24:22.608014Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.608718Z", "completed_at": "2026-01-04T19:24:22.608721Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.00611114501953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_ref_currencies_currency_code.d63b1b275d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    currency_code as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"ref_currencies\"\nwhere currency_code is not null\ngroup by currency_code\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_ref_currencies_currency_code\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.609783Z", "completed_at": "2026-01-04T19:24:22.614221Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.615666Z", "completed_at": "2026-01-04T19:24:22.615671Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007116079330444336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_currency_rates_exchange_rate.569cfda304", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\"\nwhere exchange_rate is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_currency_rates_exchange_rate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.612968Z", "completed_at": "2026-01-04T19:24:22.615989Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.616458Z", "completed_at": "2026-01-04T19:24:22.616461Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.006825923919677734, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_currency_rates_rate_date.ba57f726af", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\"\nwhere rate_date is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_currency_rates_rate_date\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.611597Z", "completed_at": "2026-01-04T19:24:22.616116Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.616793Z", "completed_at": "2026-01-04T19:24:22.616796Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007292747497558594, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_currency_rates_from_currency.a10e0aa6cf", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\"\nwhere from_currency is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_currency_rates_from_currency\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.614353Z", "completed_at": "2026-01-04T19:24:22.616647Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.617288Z", "completed_at": "2026-01-04T19:24:22.617291Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006325960159301758, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_service_types_service_type_id.0e5e637f29", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_service_types\"\nwhere service_type_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_service_types_service_type_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.618274Z", "completed_at": "2026-01-04T19:24:22.623289Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.624781Z", "completed_at": "2026-01-04T19:24:22.624785Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007809877395629883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_ref_service_types_service_type_id.6433612955", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    service_type_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"ref_service_types\"\nwhere service_type_id is not null\ngroup by service_type_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_ref_service_types_service_type_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.619943Z", "completed_at": "2026-01-04T19:24:22.625053Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.625521Z", "completed_at": "2026-01-04T19:24:22.625524Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0077190399169921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_ref_trip_status_status_id.aef8f9c769", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"ref_trip_status\"\nwhere status_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_ref_trip_status_status_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.621254Z", "completed_at": "2026-01-04T19:24:22.625341Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.626003Z", "completed_at": "2026-01-04T19:24:22.626007Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007899761199951172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_ref_trip_status_status_id.b44283f77d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    status_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"ref_trip_status\"\nwhere status_id is not null\ngroup by status_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_ref_trip_status_status_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.623457Z", "completed_at": "2026-01-04T19:24:22.625861Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.626521Z", "completed_at": "2026-01-04T19:24:22.626523Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006912946701049805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_drivers", "compiled": true, "compiled_code": "/*\n    Model: stg_drivers\n    Source: Driver App / HR System\n    Description: Staging model for driver profile data.\n                 Prepares data for SCD Type 2 dimension.\n    \n    Problems Addressed:\n    - #16 PII Handling: Masks SSN, email, phone in non-prod\n    - #11 Slowly vs Rapidly Changing: Separates static vs dynamic attributes\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_drivers\"\n),\n\nstandardized as (\n    select\n        -- Driver identifiers\n        driver_id,\n        \n        -- PII fields (conditionally masked)\n        \n        md5(first_name) as first_name_hash,\n        md5(last_name) as last_name_hash,\n        md5(email) as email_hash,\n        md5(phone) as phone_hash,\n        '****' as ssn_masked,\n        \n        \n        date_of_birth::date as date_of_birth,\n        \n        -- License information\n        license_number,\n        license_state,\n        license_expiry::date as license_expiry,\n        \n        -- Location\n        city_id,\n        \n        -- Status (rapidly changing - will go to mini dimension)\n        status as driver_status,\n        rating::decimal(3,2) as current_rating,\n        total_trips::integer as total_trips,\n        \n        -- Dates\n        signup_date::date as signup_date,\n        last_active_date::date as last_active_date,\n        \n        -- Background check\n        background_check_status,\n        background_check_date::date as background_check_date,\n        \n        -- Active flag\n        is_active::boolean as is_active,\n        \n        -- Create a hash for change detection (non-timestamp incremental)\n        md5(\n            coalesce(status, '') || '|' ||\n            coalesce(rating::varchar, '') || '|' ||\n            coalesce(total_trips::varchar, '') || '|' ||\n            coalesce(city_id, '') || '|' ||\n            coalesce(is_active::varchar, '')\n        ) as _row_hash,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_drivers\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.627016Z", "completed_at": "2026-01-04T19:24:22.630612Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.632099Z", "completed_at": "2026-01-04T19:24:22.632103Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006392002105712891, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_payments", "compiled": true, "compiled_code": "/*\n    Model: stg_payments\n    Source: Payments System\n    Description: Staging model for payment transactions.\n                 Handles refunds, settlements, and payment reconciliation prep.\n    \n    Problems Addressed:\n    - #3 Data Reconciliation: Prepares data for trip-payment matching\n    - #14 Idempotency: Uses payment_id as idempotency key\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_payments\"\n),\n\nstandardized as (\n    select\n        -- Payment identifiers\n        payment_id,\n        trip_id,\n        rider_id,\n        driver_id,\n        \n        -- Payment classification\n        payment_type,\n        payment_status,\n        payment_method,\n        \n        -- Card info (masked)\n        \n        case \n            when card_last_four is not null \n            then '****' || card_last_four \n            else null \n        end as card_display,\n        \n        \n        -- Financial amounts (in transaction currency)\n        amount_charged::decimal(12,2) as amount_charged_local,\n        currency_code,\n        amount_to_driver::decimal(12,2) as amount_to_driver_local,\n        uber_fee::decimal(12,2) as uber_fee_local,\n        processing_fee::decimal(12,2) as processing_fee_local,\n        refund_amount::decimal(12,2) as refund_amount_local,\n        \n        -- Timestamps\n        payment_timestamp::timestamp as payment_timestamp,\n        settlement_date::date as settlement_date,\n        \n        -- Derived flags\n        case \n            when payment_type = 'REFUND' then true \n            else false \n        end as is_refund,\n        \n        case \n            when payment_status = 'COMPLETED' then true \n            else false \n        end as is_completed,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_payments\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.629247Z", "completed_at": "2026-01-04T19:24:22.633513Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.633954Z", "completed_at": "2026-01-04T19:24:22.633958Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007096767425537109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_riders", "compiled": true, "compiled_code": "/*\n    Model: stg_riders\n    Source: Rider App\n    Description: Staging model for rider profile data.\n    \n    Problems Addressed:\n    - #16 PII Handling: Masks personal information\n    - #27 Data Retention/GDPR: Adds retention metadata\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_riders\"\n),\n\nstandardized as (\n    select\n        -- Rider identifiers\n        rider_id,\n        \n        -- PII fields (conditionally masked)\n        \n        md5(first_name) as first_name_hash,\n        md5(last_name) as last_name_hash,\n        md5(email) as email_hash,\n        md5(phone) as phone_hash,\n        \n        \n        date_of_birth::date as date_of_birth,\n        \n        -- Location\n        city_id,\n        \n        -- Loyalty tier\n        rider_tier,\n        \n        -- Lifetime metrics\n        lifetime_trips::integer as lifetime_trips,\n        lifetime_spend_usd::decimal(12,2) as lifetime_spend_usd,\n        \n        -- Dates\n        signup_date::date as signup_date,\n        last_trip_date::date as last_trip_date,\n        \n        -- Payment\n        preferred_payment_method,\n        \n        -- Flags\n        is_active::boolean as is_active,\n        fraud_flag::boolean as fraud_flag,\n        \n        -- GDPR: Calculate data retention eligibility\n        -- Data can be deleted 7 years after last activity\n        (last_trip_date::date + interval '7 years')::date as data_retention_until,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_riders\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.630891Z", "completed_at": "2026-01-04T19:24:22.634176Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.634791Z", "completed_at": "2026-01-04T19:24:22.634793Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006176948547363281, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_surge_snapshots", "compiled": true, "compiled_code": "/*\n    Model: stg_surge_snapshots\n    Source: Surge Pricing Service\n    Description: Staging model for surge pricing snapshots.\n                 Captured every 2 minutes per zone.\n    \n    Problems Addressed:\n    - #6 Point-in-Time Joins: Surge at trip request time\n    - #11 Rapidly Changing: Surge changes every 2 minutes\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_surge_snapshots\"\n),\n\nstandardized as (\n    select\n        -- Identifiers\n        snapshot_id,\n        city_id,\n        zone_id,\n        zone_name,\n        \n        -- Surge data\n        surge_multiplier::decimal(4,2) as surge_multiplier,\n        demand_level,\n        supply_level,\n        \n        -- Timestamp\n        snapshot_timestamp::timestamp as snapshot_timestamp,\n        \n        -- Derived: Snapshot validity window (2 minutes)\n        snapshot_timestamp::timestamp as valid_from,\n        (snapshot_timestamp::timestamp + interval '2 minutes') as valid_to,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_surge_snapshots\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.632340Z", "completed_at": "2026-01-04T19:24:22.634641Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.635333Z", "completed_at": "2026-01-04T19:24:22.635336Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006403923034667969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_trips_driver_app", "compiled": true, "compiled_code": "/*\n    Model: stg_trips_driver_app\n    Source: Driver App\n    Description: Staging model for trip data from the driver application.\n                 Handles timezone conversion and standardizes column names.\n    \n    Problems Addressed:\n    - #5 Timezone Handling: Converts local timestamps to UTC\n    - #16 PII Handling: Conditionally masks driver data\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_trips_driver_app\"\n),\n\nstandardized as (\n    select\n        -- Trip identifiers\n        trip_id,\n        driver_id,\n        vehicle_id,\n        city_id,\n        service_type_id,\n        trip_status,\n        \n        -- Timestamps (kept as-is in staging, timezone conversion in integration)\n        request_timestamp::timestamp as request_timestamp_local,\n        accept_timestamp::timestamp as accept_timestamp_local,\n        pickup_timestamp::timestamp as pickup_timestamp_local,\n        dropoff_timestamp::timestamp as dropoff_timestamp_local,\n        \n        -- Location data\n        pickup_lat::decimal(10,6) as pickup_latitude,\n        pickup_lon::decimal(10,6) as pickup_longitude,\n        dropoff_lat::decimal(10,6) as dropoff_latitude,\n        dropoff_lon::decimal(10,6) as dropoff_longitude,\n        \n        -- Trip metrics\n        distance_miles::decimal(10,2) as distance_miles,\n        duration_minutes::integer as duration_minutes,\n        \n        -- Financial data (in local currency)\n        base_fare::decimal(12,2) as base_fare_local,\n        surge_multiplier::decimal(4,2) as surge_multiplier,\n        surge_amount::decimal(12,2) as surge_amount_local,\n        tips::decimal(12,2) as tips_local,\n        tolls::decimal(12,2) as tolls_local,\n        total_fare::decimal(12,2) as total_fare_local,\n        driver_earnings::decimal(12,2) as driver_earnings_local,\n        currency_code,\n        \n        -- Ratings\n        rating_by_rider::integer as driver_rating_received,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_trips_driver_app\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.635759Z", "completed_at": "2026-01-04T19:24:22.639067Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.640870Z", "completed_at": "2026-01-04T19:24:22.640874Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0065631866455078125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_trips_rider_app", "compiled": true, "compiled_code": "/*\n    Model: stg_trips_rider_app\n    Source: Rider App\n    Description: Staging model for trip data from the rider application.\n                 Contains rider-specific fields like ratings given and feedback.\n    \n    Problems Addressed:\n    - #4 Duplicate Detection: Marks potential duplicates (same rider, same time)\n    - #16 PII Handling: Masks rider contact info if var set\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_trips_rider_app\"\n),\n\n-- Detect potential duplicates (rider app can send same request twice)\nwith_duplicate_flag as (\n    select\n        *,\n        row_number() over (\n            partition by \n                -- Same rider, same pickup location, within 5 minutes\n                rider_id, \n                pickup_address,\n                date_trunc('minute', request_timestamp::timestamp)\n            order by extracted_at::timestamp\n        ) as _duplicate_rank\n    from source_data\n),\n\nstandardized as (\n    select\n        -- Trip identifiers\n        trip_id,\n        rider_id,\n        city_id,\n        service_type_id,\n        trip_status,\n        \n        -- Timestamps\n        request_timestamp::timestamp as request_timestamp_local,\n        \n        -- Addresses (may contain PII)\n        \n        md5(pickup_address) as pickup_address_hash,\n        md5(dropoff_address) as dropoff_address_hash,\n        \n        \n        -- Financial data\n        estimated_fare::decimal(12,2) as estimated_fare_local,\n        actual_fare::decimal(12,2) as actual_fare_local,\n        payment_method,\n        promo_code,\n        promo_discount::decimal(12,2) as promo_discount_local,\n        \n        -- Ratings & Feedback\n        rating_given_to_driver::integer as rider_rating_given,\n        feedback_text,\n        \n        -- Duplicate detection\n        _duplicate_rank,\n        case when _duplicate_rank > 1 then true else false end as _is_potential_duplicate,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from with_duplicate_flag\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_trips_rider_app\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.639379Z", "completed_at": "2026-01-04T19:24:22.640691Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.642490Z", "completed_at": "2026-01-04T19:24:22.642493Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.004996061325073242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "snapshot.uber_analytics.snap_driver", "compiled": true, "compiled_code": "\n\n\n\nselect\n    driver_id,\n    \n    -- PII (hashed in staging)\n    \n    first_name_hash,\n    last_name_hash,\n    email_hash,\n    phone_hash,\n    ssn_masked,\n    \n    \n    date_of_birth,\n    license_number,\n    license_state,\n    license_expiry,\n    city_id,\n    driver_status,\n    current_rating,\n    total_trips,\n    signup_date,\n    last_active_date,\n    background_check_status,\n    background_check_date,\n    is_active,\n    _row_hash,\n    extracted_at as updated_at\n    \nfrom \"uber_analytics\".\"dev_staging\".\"stg_drivers\"\n", "relation_name": "\"uber_analytics\".\"dimension\".\"snap_driver\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.637688Z", "completed_at": "2026-01-04T19:24:22.641081Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.642903Z", "completed_at": "2026-01-04T19:24:22.642906Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007732391357421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.stg_vehicles", "compiled": true, "compiled_code": "/*\n    Model: stg_vehicles\n    Source: Driver App\n    Description: Staging model for vehicle data.\n                 Supports many-to-many driver-vehicle relationship (bridge table).\n    \n    Problems Addressed:\n    - #21 Bridge Tables: Driver can have multiple vehicles\n*/\n\n\n\nwith source_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"source_vehicles\"\n),\n\nstandardized as (\n    select\n        -- Identifiers\n        vehicle_id,\n        driver_id,\n        \n        -- Vehicle details\n        make,\n        model,\n        year::integer as year,\n        color,\n        license_plate,\n        vehicle_type,\n        capacity::integer as passenger_capacity,\n        \n        -- Relationship\n        is_primary::boolean as is_primary_vehicle,\n        \n        -- Compliance dates\n        registration_expiry::date as registration_expiry,\n        insurance_expiry::date as insurance_expiry,\n        inspection_date::date as last_inspection_date,\n        \n        -- Status\n        is_active::boolean as is_active,\n        \n        -- Derived: Days until registration expires\n        registration_expiry::date - current_date as days_until_registration_expiry,\n        \n        -- Metadata\n        source_system,\n        extracted_at::timestamp as extracted_at,\n        \n        -- Audit columns\n        current_timestamp as _stg_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _stg_invocation_id\n        \n    from source_data\n)\n\nselect * from standardized", "relation_name": "\"uber_analytics\".\"dev_staging\".\"stg_vehicles\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.641230Z", "completed_at": "2026-01-04T19:24:22.643498Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.644120Z", "completed_at": "2026-01-04T19:24:22.644123Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005354166030883789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_drivers_driver_id.a38f982d3a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_drivers\"\nwhere driver_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_drivers_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.644634Z", "completed_at": "2026-01-04T19:24:22.649830Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.650296Z", "completed_at": "2026-01-04T19:24:22.650299Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0069501399993896484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_stg_drivers_driver_id.4bdb9070a4", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    driver_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"stg_drivers\"\nwhere driver_id is not null\ngroup by driver_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_stg_drivers_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.646132Z", "completed_at": "2026-01-04T19:24:22.650142Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.651798Z", "completed_at": "2026-01-04T19:24:22.651806Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007994890213012695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_payments_payment_id.c19cc50075", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_payments\"\nwhere payment_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_payments_payment_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.648511Z", "completed_at": "2026-01-04T19:24:22.652017Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.652538Z", "completed_at": "2026-01-04T19:24:22.652540Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00821828842163086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_payments_trip_id.f6408b2c8a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_payments\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_payments_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.650521Z", "completed_at": "2026-01-04T19:24:22.652880Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.653444Z", "completed_at": "2026-01-04T19:24:22.653447Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005095958709716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_stg_payments_payment_id.3744510712", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    payment_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"stg_payments\"\nwhere payment_id is not null\ngroup by payment_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_stg_payments_payment_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.653925Z", "completed_at": "2026-01-04T19:24:22.655008Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.656743Z", "completed_at": "2026-01-04T19:24:22.656746Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0040130615234375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "snapshot.uber_analytics.snap_rider", "compiled": true, "compiled_code": "\n\n\n\nselect\n    rider_id,\n    \n    \n    first_name_hash,\n    last_name_hash,\n    email_hash,\n    phone_hash,\n    \n    \n    date_of_birth,\n    city_id,\n    rider_tier,\n    lifetime_trips,\n    lifetime_spend_usd,\n    signup_date,\n    last_trip_date,\n    preferred_payment_method,\n    is_active,\n    fraud_flag,\n    data_retention_until,\n    extracted_at as updated_at\n    \nfrom \"uber_analytics\".\"dev_staging\".\"stg_riders\"\n", "relation_name": "\"uber_analytics\".\"dimension\".\"snap_rider\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.655330Z", "completed_at": "2026-01-04T19:24:22.658472Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.658944Z", "completed_at": "2026-01-04T19:24:22.658947Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0059430599212646484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_riders_rider_id.8c49fc8818", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_riders\"\nwhere rider_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_riders_rider_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.657138Z", "completed_at": "2026-01-04T19:24:22.660958Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.661446Z", "completed_at": "2026-01-04T19:24:22.661449Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007676839828491211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_stg_riders_rider_id.b919c634e2", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rider_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"stg_riders\"\nwhere rider_id is not null\ngroup by rider_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_stg_riders_rider_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.659151Z", "completed_at": "2026-01-04T19:24:22.665146Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.665658Z", "completed_at": "2026-01-04T19:24:22.665661Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008713960647583008, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.dim_geography", "compiled": true, "compiled_code": "/*\n    Model: dim_geography\n    Layer: Dimension\n    Description: \n        Geography dimension with hierarchical structure.\n        Zone \u2192 City \u2192 Country \u2192 Region hierarchy.\n    \n    Problems Addressed:\n    - #9 Hierarchical Data: Zone \u2192 City \u2192 Country \u2192 Region\n    - #22 Outrigger Dimensions: City links to country details\n*/\n\n\n\nwith cities as (\n    select * from \"uber_analytics\".\"dev_staging\".\"ref_cities\"\n),\n\nsurge_zones as (\n    -- Get distinct zones from surge data\n    select distinct\n        city_id,\n        zone_id,\n        zone_name\n    from \"uber_analytics\".\"dev_staging\".\"stg_surge_snapshots\"\n),\n\n-- Build geography hierarchy\ngeography as (\n    select\n        -- Zone level (most granular)\n        coalesce(z.zone_id, c.city_id || '_DEFAULT') as zone_id,\n        coalesce(z.zone_name, c.city_name || ' - Default Zone') as zone_name,\n        \n        -- City level\n        c.city_id,\n        c.city_name,\n        c.timezone,\n        c.currency_code,\n        \n        -- Country level\n        c.country_code,\n        c.country_name,\n        \n        -- Region level (highest)\n        c.region,\n        \n        -- Fiscal calendar info\n        c.fiscal_year_start_month,\n        \n        -- Status\n        c.is_active,\n        \n        -- Hierarchy path (for tree navigation)\n        c.region || ' > ' || c.country_name || ' > ' || c.city_name || ' > ' || \n            coalesce(z.zone_name, 'Default') as hierarchy_path,\n        \n        -- Hierarchy level\n        4 as hierarchy_level,  -- Zone is level 4\n        \n        -- Parent keys (for drill-up)\n        c.city_id as parent_city_id,\n        c.country_code as parent_country_code,\n        c.region as parent_region\n        \n    from cities c\n    left join surge_zones z on c.city_id = z.city_id\n)\n\nselect\n    -- Surrogate key\n    \n    md5(\n        \n            coalesce(cast(zone_id as varchar), '_NULL_')\n            \n        \n    )\n as geography_key,\n    *,\n    -- Audit\n    current_timestamp as _loaded_at,\n    '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\nfrom geography", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"dim_geography\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.661683Z", "completed_at": "2026-01-04T19:24:22.666009Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.668142Z", "completed_at": "2026-01-04T19:24:22.668147Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009371042251586914, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.fct_surge_snapshot", "compiled": true, "compiled_code": "/*\n    Model: fct_surge_snapshot\n    Layer: Fact\n    Description: \n        Periodic snapshot of surge pricing by zone.\n        Captured every 2 minutes for point-in-time surge lookups.\n    \n    Problems Addressed:\n    - #6 Point-in-Time Joins: Surge at trip request time\n    - #11 Rapidly Changing: Surge changes every 2 minutes\n*/\n\n\n\nwith surge_data as (\n    select * from \"uber_analytics\".\"dev_staging\".\"stg_surge_snapshots\"\n),\n\nsnapshot as (\n    select\n        -- Surrogate key\n        \n    md5(\n        \n            coalesce(cast(city_id as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(zone_id as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(snapshot_timestamp as varchar), '_NULL_')\n            \n        \n    )\n as snapshot_key,\n        \n        -- Natural keys\n        snapshot_id,\n        city_id,\n        zone_id,\n        zone_name,\n        \n        -- Date key\n        to_char(snapshot_timestamp::date, 'YYYYMMDD')::integer as date_key,\n        \n        -- Timestamp\n        snapshot_timestamp,\n        valid_from,\n        valid_to,\n        \n        -- Surge measures\n        surge_multiplier,\n        \n        -- Supply/demand indicators\n        demand_level,\n        supply_level,\n        \n        -- Derived measures\n        case \n            when surge_multiplier >= 2.0 then 'CRITICAL'\n            when surge_multiplier >= 1.5 then 'HIGH'\n            when surge_multiplier >= 1.2 then 'MODERATE'\n            else 'NORMAL'\n        end as surge_level,\n        \n        -- For aggregation\n        case when surge_multiplier > 1.0 then 1 else 0 end as is_surge_active,\n        \n        -- Hour of day (for pattern analysis)\n        extract(hour from snapshot_timestamp)::integer as hour_of_day,\n        extract(dow from snapshot_timestamp)::integer as day_of_week,\n        \n        -- Audit\n        extracted_at,\n        current_timestamp as _fact_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n        \n    from surge_data\n)\n\nselect * from snapshot\n\n\n    where snapshot_timestamp > (select max(snapshot_timestamp) from \"uber_analytics\".\"dev_fact\".\"fct_surge_snapshot\")\n", "relation_name": "\"uber_analytics\".\"dev_fact\".\"fct_surge_snapshot\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.666154Z", "completed_at": "2026-01-04T19:24:22.670084Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.670786Z", "completed_at": "2026-01-04T19:24:22.670790Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.005792140960693359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_surge_snapshots_snapshot_id.99f1ffd09e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_surge_snapshots\"\nwhere snapshot_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_surge_snapshots_snapshot_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.668584Z", "completed_at": "2026-01-04T19:24:22.670997Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.673658Z", "completed_at": "2026-01-04T19:24:22.673661Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00780487060546875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_stg_surge_snapshots_snapshot_id.e1231cd62f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    snapshot_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"stg_surge_snapshots\"\nwhere snapshot_id is not null\ngroup by snapshot_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_stg_surge_snapshots_snapshot_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.671144Z", "completed_at": "2026-01-04T19:24:22.675561Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.676054Z", "completed_at": "2026-01-04T19:24:22.676057Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.007642269134521484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_trips_driver_app_currency_code.f702456a4b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_trips_driver_app\"\nwhere currency_code is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_trips_driver_app_currency_code\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.673907Z", "completed_at": "2026-01-04T19:24:22.677491Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.678086Z", "completed_at": "2026-01-04T19:24:22.678089Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007503986358642578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_trips_driver_app_driver_id.f127b86b48", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_trips_driver_app\"\nwhere driver_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_trips_driver_app_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.676274Z", "completed_at": "2026-01-04T19:24:22.682103Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.682625Z", "completed_at": "2026-01-04T19:24:22.682629Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.00745391845703125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_trips_driver_app_trip_id.9cd277084a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_trips_driver_app\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_trips_driver_app_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.678323Z", "completed_at": "2026-01-04T19:24:22.682855Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.684501Z", "completed_at": "2026-01-04T19:24:22.684504Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008619070053100586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.int_trips_unified", "compiled": true, "compiled_code": "/*\n    Model: int_trips_unified\n    Layer: Integration\n    Description: \n        Unified trip model combining driver and rider app data.\n        Handles deduplication, late arrivals, and data enrichment.\n    \n    Problems Addressed:\n    - #1 Late-Arriving Facts: Identifies and handles late arrivals\n    - #2 Orphan Records: Validates against dimensions\n    - #4 Duplicate Detection: Removes duplicates from rider app\n    - #5 Timezone Handling: Converts to UTC\n    - #10 Multi-Source Merge: Combines driver + rider data\n*/\n\n\n\nwith driver_trips as (\n    select * from \"uber_analytics\".\"dev_staging\".\"stg_trips_driver_app\"\n),\n\nrider_trips as (\n    -- Exclude duplicates from rider app\n    select * from \"uber_analytics\".\"dev_staging\".\"stg_trips_rider_app\"\n    where _is_potential_duplicate = false\n),\n\n-- Get city timezones for conversion\ncities as (\n    select city_id, timezone from \"uber_analytics\".\"dev_staging\".\"ref_cities\"\n),\n\n-- Combine driver and rider data\ncombined as (\n    select\n        -- Use driver app as primary source\n        d.trip_id,\n        d.driver_id,\n        r.rider_id,\n        d.vehicle_id,\n        d.city_id,\n        d.service_type_id,\n        d.trip_status,\n        \n        -- Timestamps (convert to UTC)\n        d.request_timestamp_local,\n        d.request_timestamp_local at time zone c.timezone at time zone 'UTC' as request_timestamp_utc,\n        d.accept_timestamp_local at time zone c.timezone at time zone 'UTC' as accept_timestamp_utc,\n        d.pickup_timestamp_local at time zone c.timezone at time zone 'UTC' as pickup_timestamp_utc,\n        d.dropoff_timestamp_local at time zone c.timezone at time zone 'UTC' as dropoff_timestamp_utc,\n        \n        -- Location\n        d.pickup_latitude,\n        d.pickup_longitude,\n        d.dropoff_latitude,\n        d.dropoff_longitude,\n        \n        -- Metrics\n        d.distance_miles,\n        d.duration_minutes,\n        \n        -- Financial (local currency)\n        d.base_fare_local,\n        d.surge_multiplier,\n        d.surge_amount_local,\n        d.tips_local,\n        d.tolls_local,\n        d.total_fare_local,\n        d.driver_earnings_local,\n        d.currency_code,\n        \n        -- Promo from rider app\n        r.promo_code,\n        r.promo_discount_local,\n        \n        -- Ratings from both sides\n        d.driver_rating_received,\n        r.rider_rating_given,\n        r.feedback_text,\n        \n        -- Payment\n        r.payment_method,\n        \n        -- Late arrival detection\n        \n    case \n        when d.extracted_at > (d.request_timestamp_local + interval '24 hours')\n        then true\n        else false\n    end\n as is_late_arrival,\n        \n        -- Metadata\n        d.source_system as driver_source,\n        r.source_system as rider_source,\n        greatest(d.extracted_at, coalesce(r.extracted_at, d.extracted_at)) as extracted_at,\n        \n        -- Audit\n        current_timestamp as _int_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _int_invocation_id\n        \n    from driver_trips d\n    left join rider_trips r on d.trip_id = r.trip_id\n    left join cities c on d.city_id = c.city_id\n),\n\n-- Add currency conversion to USD\nwith_usd as (\n    select\n        *,\n        -- Convert all monetary values to USD at transaction date\n        \n    case \n        when currency_code = 'USD' then base_fare_local\n        else base_fare_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as base_fare_usd,\n        \n    case \n        when currency_code = 'USD' then surge_amount_local\n        else surge_amount_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as surge_amount_usd,\n        \n    case \n        when currency_code = 'USD' then tips_local\n        else tips_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as tips_usd,\n        \n    case \n        when currency_code = 'USD' then tolls_local\n        else tolls_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as tolls_usd,\n        \n    case \n        when currency_code = 'USD' then total_fare_local\n        else total_fare_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as total_fare_usd,\n        \n    case \n        when currency_code = 'USD' then driver_earnings_local\n        else driver_earnings_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as driver_earnings_usd,\n        \n    case \n        when currency_code = 'USD' then promo_discount_local\n        else promo_discount_local * coalesce(\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date = request_timestamp_local::date\n            ),\n            -- Fallback: use most recent rate before the date\n            (\n                select exchange_rate \n                from \"uber_analytics\".\"dev_staging\".\"ref_currency_rates\" rates\n                where rates.from_currency = currency_code\n                  and rates.to_currency = 'USD'\n                  and rates.rate_date <= request_timestamp_local::date\n                order by rates.rate_date desc\n                limit 1\n            ),\n            1.0  -- Ultimate fallback\n        )\n    end\n as promo_discount_usd\n    from combined\n)\n\nselect * from with_usd\n\n\n    where extracted_at > (select max(extracted_at) from \"uber_analytics\".\"dev_integration\".\"int_trips_unified\")\n       or is_late_arrival = true  -- Always reprocess late arrivals\n", "relation_name": "\"uber_analytics\".\"dev_integration\".\"int_trips_unified\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.683133Z", "completed_at": "2026-01-04T19:24:22.685277Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.687059Z", "completed_at": "2026-01-04T19:24:22.687063Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005111217498779297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_trips_rider_app_rider_id.9303b5a0d3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_trips_rider_app\"\nwhere rider_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_trips_rider_app_rider_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.685456Z", "completed_at": "2026-01-04T19:24:22.689239Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.690865Z", "completed_at": "2026-01-04T19:24:22.690869Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007889032363891602, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_trips_rider_app_trip_id.4c14c521ea", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_trips_rider_app\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_trips_rider_app_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.687310Z", "completed_at": "2026-01-04T19:24:22.690736Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.691282Z", "completed_at": "2026-01-04T19:24:22.691285Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006381988525390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.dim_driver", "compiled": true, "compiled_code": "/*\n    Model: dim_driver\n    Layer: Dimension\n    Description: \n        Driver dimension built from SCD Type 2 snapshot.\n        Supports point-in-time lookups using valid_from/valid_to.\n    \n    Problems Addressed:\n    - #6 Point-in-Time Joins\n    - #11 SCD Type 2\n*/\n\n\n\nwith snapshot_data as (\n    select * from \"uber_analytics\".\"dimension\".\"snap_driver\"\n),\n\nenriched as (\n    select\n        -- Surrogate key for this version\n        \n    md5(\n        coalesce(cast(driver_id as varchar), '_NULL_') || '|' ||\n        coalesce(cast(dbt_valid_from as varchar), '_NULL_')\n    )\n as driver_key,\n        \n        -- Natural key\n        driver_id,\n        \n        -- Attributes (from snapshot)\n        \n        first_name_hash,\n        last_name_hash,\n        email_hash,\n        phone_hash,\n        ssn_masked,\n        \n        \n        date_of_birth,\n        license_number,\n        license_state,\n        license_expiry,\n        city_id,\n        driver_status,\n        current_rating,\n        total_trips,\n        signup_date,\n        last_active_date,\n        background_check_status,\n        background_check_date,\n        is_active,\n        \n        -- SCD2 validity\n        dbt_valid_from as valid_from,\n        dbt_valid_to as valid_to,\n        \n        -- Current record flag\n        case \n            when dbt_valid_to is null then true \n            else false \n        end as is_current,\n        \n        -- Row hash for change detection\n        _row_hash,\n        \n        -- Audit\n        dbt_scd_id,\n        dbt_updated_at,\n        current_timestamp as _loaded_at\n        \n    from snapshot_data\n)\n\nselect * from enriched", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"dim_driver\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.689414Z", "completed_at": "2026-01-04T19:24:22.691497Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.693292Z", "completed_at": "2026-01-04T19:24:22.693294Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.006422996520996094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.bridge_driver_vehicle", "compiled": true, "compiled_code": "/*\n    Model: bridge_driver_vehicle\n    Layer: Dimension\n    Description: \n        Bridge table for many-to-many driver-vehicle relationship.\n        A driver can have multiple vehicles, each vehicle at different times.\n    \n    Problems Addressed:\n    - #21 Bridge Tables: Driver \u2194 Vehicle many-to-many\n*/\n\n\n\nwith vehicles as (\n    select * from \"uber_analytics\".\"dev_staging\".\"stg_vehicles\"\n),\n\nbridge as (\n    select\n        -- Bridge key\n        \n    md5(\n        \n            coalesce(cast(driver_id as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(vehicle_id as varchar), '_NULL_')\n            \n        \n    )\n as bridge_key,\n        \n        -- Keys\n        driver_id,\n        vehicle_id,\n        \n        -- Relationship attributes\n        is_primary_vehicle,\n        \n        -- Vehicle attributes (denormalized for convenience)\n        make,\n        model,\n        year,\n        color,\n        license_plate,\n        vehicle_type,\n        passenger_capacity,\n        \n        -- Compliance\n        registration_expiry,\n        insurance_expiry,\n        last_inspection_date,\n        days_until_registration_expiry,\n        \n        -- Status\n        is_active,\n        \n        -- For weighting in aggregations\n        case when is_primary_vehicle then 1.0 else 0.5 end as allocation_weight,\n        \n        -- Audit\n        extracted_at,\n        current_timestamp as _loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n        \n    from vehicles\n)\n\nselect * from bridge", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"bridge_driver_vehicle\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.691794Z", "completed_at": "2026-01-04T19:24:22.694007Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.694556Z", "completed_at": "2026-01-04T19:24:22.694558Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.003993034362792969, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_vehicles_driver_id.cb513ef6ad", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_vehicles\"\nwhere driver_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_vehicles_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.694837Z", "completed_at": "2026-01-04T19:24:22.700022Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.700479Z", "completed_at": "2026-01-04T19:24:22.700483Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006966114044189453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_stg_vehicles_vehicle_id.2ce9dc4645", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_staging\".\"stg_vehicles\"\nwhere vehicle_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_stg_vehicles_vehicle_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.696018Z", "completed_at": "2026-01-04T19:24:22.700179Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.700704Z", "completed_at": "2026-01-04T19:24:22.700706Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007012844085693359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_stg_vehicles_vehicle_id.1c15938e93", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    vehicle_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_staging\".\"stg_vehicles\"\nwhere vehicle_id is not null\ngroup by vehicle_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_stg_vehicles_vehicle_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.698523Z", "completed_at": "2026-01-04T19:24:22.700889Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.702612Z", "completed_at": "2026-01-04T19:24:22.702614Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.008201837539672852, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.dim_rider", "compiled": true, "compiled_code": "/*\n    Model: dim_rider\n    Layer: Dimension\n    Description: \n        Rider dimension built from SCD Type 2 snapshot.\n    \n    Problems Addressed:\n    - #6 Point-in-Time Joins\n    - #27 Data Retention/GDPR: Includes retention date\n*/\n\n\n\nwith snapshot_data as (\n    select * from \"uber_analytics\".\"dimension\".\"snap_rider\"\n),\n\nenriched as (\n    select\n        -- Surrogate key for this version\n        \n    md5(\n        coalesce(cast(rider_id as varchar), '_NULL_') || '|' ||\n        coalesce(cast(dbt_valid_from as varchar), '_NULL_')\n    )\n as rider_key,\n        \n        -- Natural key\n        rider_id,\n        \n        -- Attributes\n        \n        first_name_hash,\n        last_name_hash,\n        email_hash,\n        phone_hash,\n        \n        \n        date_of_birth,\n        city_id,\n        rider_tier,\n        lifetime_trips,\n        lifetime_spend_usd,\n        signup_date,\n        last_trip_date,\n        preferred_payment_method,\n        is_active,\n        fraud_flag,\n        \n        -- GDPR retention\n        data_retention_until,\n        case \n            when data_retention_until < current_date then true \n            else false \n        end as is_eligible_for_deletion,\n        \n        -- SCD2 validity\n        dbt_valid_from as valid_from,\n        dbt_valid_to as valid_to,\n        case when dbt_valid_to is null then true else false end as is_current,\n        \n        -- Audit\n        dbt_scd_id,\n        dbt_updated_at,\n        current_timestamp as _loaded_at\n        \n    from snapshot_data\n)\n\nselect * from enriched", "relation_name": "\"uber_analytics\".\"dev_dimension\".\"dim_rider\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.701052Z", "completed_at": "2026-01-04T19:24:22.703342Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.703935Z", "completed_at": "2026-01-04T19:24:22.703938Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004091024398803711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_geography_geography_key.c102675438", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_geography\"\nwhere geography_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_geography_geography_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.704153Z", "completed_at": "2026-01-04T19:24:22.708204Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.708667Z", "completed_at": "2026-01-04T19:24:22.708669Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005815029144287109, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_geography_zone_id.bdaf5d6b74", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_geography\"\nwhere zone_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_geography_zone_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.705367Z", "completed_at": "2026-01-04T19:24:22.708530Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.709032Z", "completed_at": "2026-01-04T19:24:22.709034Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006092071533203125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_geography_geography_key.0bbb80e1c1", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    geography_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_geography\"\nwhere geography_key is not null\ngroup by geography_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_geography_geography_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.706903Z", "completed_at": "2026-01-04T19:24:22.709283Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.710941Z", "completed_at": "2026-01-04T19:24:22.710943Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007157325744628906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_surge_snapshot_snapshot_key.1c185486b5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_surge_snapshot\"\nwhere snapshot_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_surge_snapshot_snapshot_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.709596Z", "completed_at": "2026-01-04T19:24:22.711756Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.713619Z", "completed_at": "2026-01-04T19:24:22.713621Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0052912235260009766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_fct_surge_snapshot_snapshot_key.f8bc56dcc3", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    snapshot_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_fact\".\"fct_surge_snapshot\"\nwhere snapshot_key is not null\ngroup by snapshot_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_fct_surge_snapshot_snapshot_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.712158Z", "completed_at": "2026-01-04T19:24:22.716589Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.717066Z", "completed_at": "2026-01-04T19:24:22.717068Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00593113899230957, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.int_payments_reconciled", "compiled": true, "compiled_code": "/*\n    Model: int_payments_reconciled\n    Layer: Integration\n    Description: \n        Payment data reconciled with trips.\n        Identifies orphan payments and calculates net amounts.\n    \n    Problems Addressed:\n    - #2 Orphan Records: Flags payments without matching trips\n    - #3 Data Reconciliation: Matches payments to trips\n    - #14 Idempotency: Uses payment_id as idempotency key\n*/\n\n\n\nwith payments as (\n    select * from \"uber_analytics\".\"dev_staging\".\"stg_payments\"\n),\n\ntrips as (\n    select trip_id from \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\n),\n\n-- Check for orphan payments (no matching trip)\nwith_trip_check as (\n    select\n        p.*,\n        case when t.trip_id is null then true else false end as is_orphan_payment\n    from payments p\n    left join trips t on p.trip_id = t.trip_id\n),\n\n-- Aggregate refunds per trip\nrefunds as (\n    select\n        trip_id,\n        sum(refund_amount_local) as total_refund_local\n    from payments\n    where is_refund = true\n    group by trip_id\n),\n\n-- Calculate net amounts\nenriched as (\n    select\n        p.payment_id,\n        p.trip_id,\n        p.rider_id,\n        p.driver_id,\n        p.payment_type,\n        p.payment_status,\n        p.payment_method,\n        p.card_display,\n        \n        -- Gross amounts\n        p.amount_charged_local,\n        p.currency_code,\n        p.amount_to_driver_local,\n        p.uber_fee_local,\n        p.processing_fee_local,\n        p.refund_amount_local,\n        \n        -- Net amounts (after refunds)\n        p.amount_charged_local - coalesce(r.total_refund_local, 0) as net_amount_charged_local,\n        \n        -- Timestamps\n        p.payment_timestamp,\n        p.settlement_date,\n        \n        -- Flags\n        p.is_refund,\n        p.is_completed,\n        p.is_orphan_payment,\n        \n        -- Reconciliation status\n        case\n            when p.is_orphan_payment then 'ORPHAN'\n            when p.is_completed then 'RECONCILED'\n            else 'PENDING'\n        end as reconciliation_status,\n        \n        -- Metadata\n        p.source_system,\n        p.extracted_at,\n        \n        -- Audit\n        current_timestamp as _int_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _int_invocation_id\n        \n    from with_trip_check p\n    left join refunds r on p.trip_id = r.trip_id and p.is_refund = false\n)\n\nselect * from enriched\n\n\n    where extracted_at > (select max(extracted_at) from \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\")\n", "relation_name": "\"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.713826Z", "completed_at": "2026-01-04T19:24:22.716911Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.717559Z", "completed_at": "2026-01-04T19:24:22.717562Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006273984909057617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_int_trips_unified_total_fare_usd.b21590b9a0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\nwhere total_fare_usd is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_int_trips_unified_total_fare_usd\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.715414Z", "completed_at": "2026-01-04T19:24:22.717403Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.719745Z", "completed_at": "2026-01-04T19:24:22.719749Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0077419281005859375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_int_trips_unified_trip_id.661b23030d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_int_trips_unified_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.718106Z", "completed_at": "2026-01-04T19:24:22.720819Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.723426Z", "completed_at": "2026-01-04T19:24:22.723429Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.006719112396240234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_int_trips_unified_trip_id.367e3eaee4", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trip_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\nwhere trip_id is not null\ngroup by trip_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_int_trips_unified_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.721197Z", "completed_at": "2026-01-04T19:24:22.726281Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.726622Z", "completed_at": "2026-01-04T19:24:22.726625Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0064699649810791016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_driver_driver_id.f908337ec6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_driver\"\nwhere driver_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_driver_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.723763Z", "completed_at": "2026-01-04T19:24:22.726826Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.727384Z", "completed_at": "2026-01-04T19:24:22.727386Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006871938705444336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_driver_driver_key.158a3ae984", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_driver\"\nwhere driver_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_driver_driver_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.725121Z", "completed_at": "2026-01-04T19:24:22.727256Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.728886Z", "completed_at": "2026-01-04T19:24:22.728888Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.00796198844909668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_driver_driver_key.0ba470a94f", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    driver_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_driver\"\nwhere driver_key is not null\ngroup by driver_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_driver_driver_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.727587Z", "completed_at": "2026-01-04T19:24:22.729597Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.731133Z", "completed_at": "2026-01-04T19:24:22.731135Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.004715919494628906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_bridge_driver_vehicle_bridge_key.b96dfaaad5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"bridge_driver_vehicle\"\nwhere bridge_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_bridge_driver_vehicle_bridge_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.729848Z", "completed_at": "2026-01-04T19:24:22.733757Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.735548Z", "completed_at": "2026-01-04T19:24:22.735551Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0068171024322509766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_bridge_driver_vehicle_bridge_key.02bdd47a01", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    bridge_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"bridge_driver_vehicle\"\nwhere bridge_key is not null\ngroup by bridge_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_bridge_driver_vehicle_bridge_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.731818Z", "completed_at": "2026-01-04T19:24:22.735983Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.737804Z", "completed_at": "2026-01-04T19:24:22.737808Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.008117914199829102, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.fct_trips", "compiled": true, "compiled_code": "/*\n    Model: fct_trips\n    Layer: Fact\n    Description: \n        Transaction grain fact table for trips.\n        One row per trip with all dimensional keys and measures.\n    \n    Problems Addressed:\n    - #1 Late-Arriving Facts: Reprocesses late arrivals\n    - #6 Point-in-Time: Links to driver version at trip time\n    - #7 Currency Conversion: All amounts in USD\n    - #13 Backfill: Supports historical reprocessing\n    - #17 Large Table Joins: Optimized with surrogate keys\n    - #19 Partitioning: Partitioned by request date\n    - #20 Role-Playing: Multiple date dimension joins\n    - #25 Junk Dimension: Uses trip_flag_key\n*/\n\n\n\nwith trips as (\n    select * from \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\n),\n\n-- Get service type attributes\nservice_types as (\n    select * from \"uber_analytics\".\"dev_staging\".\"ref_service_types\"\n),\n\n-- Get driver at time of trip (point-in-time SCD2 lookup)\ndrivers as (\n    select * from \"uber_analytics\".\"dev_dimension\".\"dim_driver\"\n),\n\n-- Get rider at time of trip\nriders as (\n    select * from \"uber_analytics\".\"dev_dimension\".\"dim_rider\"\n),\n\n-- Get trip flag dimension key\ntrip_flags as (\n    select * from \"uber_analytics\".\"dev_dimension\".\"dim_trip_flags\"\n),\n\n-- Build fact table\nfact as (\n    select\n        -- Primary key\n        t.trip_id,\n        \n        -- Dimension keys (for star schema joins)\n        -- Date keys (role-playing)\n        to_char(t.request_timestamp_utc::date, 'YYYYMMDD')::integer as request_date_key,\n        to_char(t.pickup_timestamp_utc::date, 'YYYYMMDD')::integer as pickup_date_key,\n        to_char(t.dropoff_timestamp_utc::date, 'YYYYMMDD')::integer as dropoff_date_key,\n        \n        -- Driver key (point-in-time)\n        d.driver_key,\n        t.driver_id,\n        \n        -- Rider key (point-in-time)\n        r.rider_key,\n        t.rider_id,\n        \n        -- Vehicle\n        t.vehicle_id,\n        \n        -- Geography\n        t.city_id,\n        \n        -- Service type\n        t.service_type_id,\n        \n        -- Trip flag (junk dimension)\n        tf.trip_flag_key,\n        \n        -- Degenerate dimensions\n        t.trip_status,\n        t.promo_code,\n        t.payment_method,\n        \n        -- Timestamps (UTC)\n        t.request_timestamp_utc,\n        t.accept_timestamp_utc,\n        t.pickup_timestamp_utc,\n        t.dropoff_timestamp_utc,\n        \n        -- Date (for partitioning)\n        t.request_timestamp_utc::date as request_date,\n        \n        -- Location measures\n        t.pickup_latitude,\n        t.pickup_longitude,\n        t.dropoff_latitude,\n        t.dropoff_longitude,\n        \n        -- Trip metrics\n        t.distance_miles,\n        t.duration_minutes,\n        t.surge_multiplier,\n        \n        -- Financial measures (local currency)\n        t.currency_code,\n        t.base_fare_local,\n        t.surge_amount_local,\n        t.tips_local,\n        t.tolls_local,\n        t.promo_discount_local,\n        t.total_fare_local,\n        t.driver_earnings_local,\n        \n        -- Financial measures (USD - for aggregation)\n        t.base_fare_usd,\n        t.surge_amount_usd,\n        t.tips_usd,\n        t.tolls_usd,\n        t.promo_discount_usd,\n        t.total_fare_usd,\n        t.driver_earnings_usd,\n        \n        -- Calculated measures\n        t.total_fare_usd * st.commission_rate as uber_commission_usd,\n        t.total_fare_usd - t.driver_earnings_usd as uber_net_revenue_usd,\n        \n        -- Ratings\n        t.driver_rating_received,\n        t.rider_rating_given,\n        \n        -- Driver rating at time of trip (point-in-time)\n        d.current_rating as driver_rating_at_trip,\n        \n        -- Rider tier at time of trip\n        r.rider_tier as rider_tier_at_trip,\n        \n        -- Operational flags\n        t.is_late_arrival,\n        \n        -- Time metrics\n        extract(epoch from (t.accept_timestamp_utc - t.request_timestamp_utc))/60 as time_to_accept_minutes,\n        extract(epoch from (t.pickup_timestamp_utc - t.accept_timestamp_utc))/60 as time_to_pickup_minutes,\n        \n        -- Audit\n        t.extracted_at,\n        t._int_loaded_at,\n        current_timestamp as _fact_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n        \n    from trips t\n    left join service_types st on t.service_type_id = st.service_type_id\n    -- Point-in-time join to driver (driver version valid at trip time)\n    left join drivers d on t.driver_id = d.driver_id\n        and t.request_timestamp_utc >= d.valid_from\n        and (t.request_timestamp_utc < d.valid_to or d.valid_to is null)\n    -- Point-in-time join to rider\n    left join riders r on t.rider_id = r.rider_id\n        and t.request_timestamp_utc >= r.valid_from\n        and (t.request_timestamp_utc < r.valid_to or r.valid_to is null)\n    -- Join to junk dimension\n    left join trip_flags tf on \n        tf.is_surge = (t.surge_multiplier > 1.0)\n        and tf.is_pool = (t.service_type_id = 'UBER_POOL')\n        and tf.is_premium = (t.service_type_id in ('UBER_BLACK', 'UBER_SUV'))\n        and tf.has_tip = (t.tips_usd > 0)\n        and tf.has_promo = (t.promo_code is not null)\n        and tf.is_late_arrival = t.is_late_arrival\n        and tf.is_completed = (t.trip_status = 'TRIP_COMPLETED')\n        and tf.is_cancelled = (t.trip_status like 'CANCELLED%')\n)\n\nselect * from fact\n\n\n    where extracted_at > (select max(extracted_at) from \"uber_analytics\".\"dev_fact\".\"fct_trips\")\n       or is_late_arrival = true  -- Always reprocess late arrivals\n", "relation_name": "\"uber_analytics\".\"dev_fact\".\"fct_trips\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.733896Z", "completed_at": "2026-01-04T19:24:22.736307Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.738208Z", "completed_at": "2026-01-04T19:24:22.738212Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0072400569915771484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_dim_rider_rider_key.33cbe8ecfc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_rider\"\nwhere rider_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_dim_rider_rider_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.736466Z", "completed_at": "2026-01-04T19:24:22.739013Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.741234Z", "completed_at": "2026-01-04T19:24:22.741238Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005923032760620117, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_dim_rider_rider_key.912235519d", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    rider_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_dimension\".\"dim_rider\"\nwhere rider_key is not null\ngroup by rider_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_dim_rider_rider_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.739296Z", "completed_at": "2026-01-04T19:24:22.745117Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.747728Z", "completed_at": "2026-01-04T19:24:22.747731Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009685993194580078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.fct_trip_accumulating", "compiled": true, "compiled_code": "/*\n    Model: fct_trip_accumulating\n    Layer: Fact\n    Description: \n        Accumulating snapshot fact table tracking trip lifecycle.\n        Records timestamps at each milestone: requested \u2192 assigned \u2192 started \u2192 completed \u2192 paid.\n    \n    Problems Addressed:\n    - #26 Accumulating Snapshot Facts: Track lifecycle stages\n*/\n\n\n\nwith trips as (\n    select * from \"uber_analytics\".\"dev_integration\".\"int_trips_unified\"\n),\n\npayments as (\n    select \n        trip_id,\n        min(payment_timestamp) as first_payment_timestamp,\n        max(payment_timestamp) as last_payment_timestamp,\n        count(*) as payment_count,\n        sum(case when is_refund then 1 else 0 end) as refund_count\n    from \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\n    where is_completed = true\n    group by trip_id\n),\n\naccumulating as (\n    select\n        -- Keys\n        t.trip_id,\n        t.driver_id,\n        t.rider_id,\n        t.city_id,\n        t.service_type_id,\n        \n        -- Lifecycle timestamps\n        t.request_timestamp_utc as milestone_1_requested_at,\n        t.accept_timestamp_utc as milestone_2_assigned_at,\n        t.pickup_timestamp_utc as milestone_3_started_at,\n        t.dropoff_timestamp_utc as milestone_4_completed_at,\n        p.first_payment_timestamp as milestone_5_paid_at,\n        \n        -- Current status\n        t.trip_status,\n        \n        -- Which milestone was reached?\n        case\n            when p.first_payment_timestamp is not null then 5\n            when t.dropoff_timestamp_utc is not null then 4\n            when t.pickup_timestamp_utc is not null then 3\n            when t.accept_timestamp_utc is not null then 2\n            when t.request_timestamp_utc is not null then 1\n            else 0\n        end as current_milestone,\n        \n        case\n            when p.first_payment_timestamp is not null then 'PAID'\n            when t.dropoff_timestamp_utc is not null then 'COMPLETED'\n            when t.pickup_timestamp_utc is not null then 'IN_PROGRESS'\n            when t.accept_timestamp_utc is not null then 'ASSIGNED'\n            when t.request_timestamp_utc is not null then 'REQUESTED'\n            else 'UNKNOWN'\n        end as current_milestone_name,\n        \n        -- Duration between milestones (minutes)\n        extract(epoch from (t.accept_timestamp_utc - t.request_timestamp_utc))/60 \n            as minutes_request_to_assign,\n        extract(epoch from (t.pickup_timestamp_utc - t.accept_timestamp_utc))/60 \n            as minutes_assign_to_pickup,\n        extract(epoch from (t.dropoff_timestamp_utc - t.pickup_timestamp_utc))/60 \n            as minutes_pickup_to_dropoff,\n        extract(epoch from (p.first_payment_timestamp - t.dropoff_timestamp_utc))/60 \n            as minutes_dropoff_to_payment,\n        \n        -- Total lifecycle duration\n        extract(epoch from (\n            coalesce(p.first_payment_timestamp, t.dropoff_timestamp_utc, \n                     t.pickup_timestamp_utc, t.accept_timestamp_utc, t.request_timestamp_utc)\n            - t.request_timestamp_utc\n        ))/60 as total_lifecycle_minutes,\n        \n        -- Financial measures\n        t.total_fare_usd,\n        t.driver_earnings_usd,\n        \n        -- Payment info\n        p.payment_count,\n        p.refund_count,\n        \n        -- Is lifecycle complete?\n        case when p.first_payment_timestamp is not null then true else false end as is_lifecycle_complete,\n        \n        -- Days since request (for aging)\n        current_date - t.request_timestamp_utc::date as days_since_request,\n        \n        -- Late arrival flag\n        t.is_late_arrival,\n        \n        -- Audit\n        greatest(t.extracted_at, coalesce(p.last_payment_timestamp, t.extracted_at)) as last_updated_at,\n        current_timestamp as _fact_loaded_at,\n        '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n        \n    from trips t\n    left join payments p on t.trip_id = p.trip_id\n)\n\nselect * from accumulating\n\n\n    where last_updated_at > (select max(last_updated_at) from \"uber_analytics\".\"dev_fact\".\"fct_trip_accumulating\")\n       or is_lifecycle_complete = false  -- Always update incomplete trips\n", "relation_name": "\"uber_analytics\".\"dev_fact\".\"fct_trip_accumulating\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.745281Z", "completed_at": "2026-01-04T19:24:22.748406Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.750071Z", "completed_at": "2026-01-04T19:24:22.750074Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.009012937545776367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_int_payments_reconciled_payment_id.142d71a288", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\nwhere payment_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_int_payments_reconciled_payment_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.741972Z", "completed_at": "2026-01-04T19:24:22.748536Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.750302Z", "completed_at": "2026-01-04T19:24:22.750304Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.011160850524902344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.accepted_values_int_payments_reconciled_reconciliation_status__ORPHAN__RECONCILED__PENDING.f1af08bd3b", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        reconciliation_status as value_field,\n        count(*) as n_records\n\n    from \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\n    group by reconciliation_status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'ORPHAN','RECONCILED','PENDING'\n)\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"accepted_values_int_payments_r_4b8267eb0912d68cfa99e6e0f3e82661\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.748700Z", "completed_at": "2026-01-04T19:24:22.751073Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.753927Z", "completed_at": "2026-01-04T19:24:22.753931Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.0064067840576171875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_int_payments_reconciled_payment_id.3cd2b55e55", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    payment_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\nwhere payment_id is not null\ngroup by payment_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_int_payments_reconciled_payment_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.751213Z", "completed_at": "2026-01-04T19:24:22.754717Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.758256Z", "completed_at": "2026-01-04T19:24:22.758260Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008350849151611328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.fct_driver_earnings", "compiled": true, "compiled_code": "/*\n    Model: fct_driver_earnings\n    Layer: Fact\n    Description: \n        Periodic snapshot fact table for driver earnings.\n        Aggregated by driver and payout week (Mon-Sun).\n    \n    Problems Addressed:\n    - #7 Currency Conversion: Weekly earnings in driver's payout currency\n    - #8 Fiscal Calendar: Uses payout week (Mon-Sun)\n*/\n\n\n\nwith trips as (\n    select * from \"uber_analytics\".\"dev_fact\".\"fct_trips\"\n    where trip_status = 'TRIP_COMPLETED'\n),\n\n-- Aggregate by driver and payout week\nweekly_earnings as (\n    select\n        driver_id,\n        city_id,\n        \n    -- Monday of the week\n    date_trunc('week', request_timestamp_utc)::date\n as payout_week_start,\n        \n    -- Sunday of the week\n    (date_trunc('week', request_timestamp_utc) + interval '6 days')::date\n as payout_week_end,\n        extract(isoyear from request_timestamp_utc)::integer as payout_year,\n        extract(week from request_timestamp_utc)::integer as payout_week_number,\n        \n        -- Trip counts\n        count(*) as total_trips,\n        count(case when surge_multiplier > 1.0 then 1 end) as surge_trips,\n        count(case when tips_usd > 0 then 1 end) as tipped_trips,\n        \n        -- Distance and time\n        sum(distance_miles) as total_distance_miles,\n        sum(duration_minutes) as total_trip_minutes,\n        \n        -- Earnings (USD)\n        sum(driver_earnings_usd) as gross_earnings_usd,\n        sum(tips_usd) as total_tips_usd,\n        sum(tolls_usd) as total_tolls_usd,\n        sum(driver_earnings_usd) + sum(tips_usd) as total_earnings_usd,\n        \n        -- Averages\n        avg(driver_earnings_usd) as avg_earnings_per_trip_usd,\n        avg(tips_usd) as avg_tip_per_trip_usd,\n        avg(driver_rating_received) as avg_rating_received,\n        \n        -- Efficiency metrics\n        sum(driver_earnings_usd) / nullif(sum(duration_minutes), 0) * 60 as earnings_per_hour_usd,\n        sum(driver_earnings_usd) / nullif(sum(distance_miles), 0) as earnings_per_mile_usd,\n        \n        -- Last activity\n        max(request_timestamp_utc) as last_trip_timestamp\n        \n    from trips\n    group by 1, 2, 3, 4, 5, 6\n)\n\nselect\n    -- Surrogate key\n    \n    md5(\n        \n            coalesce(cast(driver_id as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(payout_week_start as varchar), '_NULL_')\n            \n        \n    )\n as earnings_key,\n    \n    -- Keys\n    driver_id,\n    city_id,\n    to_char(payout_week_start, 'YYYYMMDD')::integer as payout_week_start_key,\n    \n    -- Period\n    payout_week_start,\n    payout_week_end,\n    payout_year,\n    payout_week_number,\n    \n    -- Trip metrics\n    total_trips,\n    surge_trips,\n    tipped_trips,\n    total_distance_miles,\n    total_trip_minutes,\n    \n    -- Earnings\n    gross_earnings_usd,\n    total_tips_usd,\n    total_tolls_usd,\n    total_earnings_usd,\n    \n    -- Averages\n    avg_earnings_per_trip_usd,\n    avg_tip_per_trip_usd,\n    avg_rating_received,\n    \n    -- Efficiency\n    earnings_per_hour_usd,\n    earnings_per_mile_usd,\n    \n    -- Activity\n    last_trip_timestamp,\n    \n    -- Audit\n    current_timestamp as _fact_loaded_at,\n    '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n    \nfrom weekly_earnings\n\n\n    where payout_week_start >= (\n        select max(payout_week_start) - interval '2 weeks' \n        from \"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"\n    )  -- Reprocess last 2 weeks for late arrivals\n", "relation_name": "\"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.754856Z", "completed_at": "2026-01-04T19:24:22.758943Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.760720Z", "completed_at": "2026-01-04T19:24:22.760723Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0071299076080322266, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.mart_reconciliation", "compiled": true, "compiled_code": "/*\n    Model: mart_reconciliation\n    Layer: Mart\n    Description: \n        Reconciliation report comparing trips to payments.\n        Identifies discrepancies for financial close.\n    \n    Problems Addressed:\n    - #3 Data Reconciliation: Trips vs Payments vs Payouts\n    - #34 Circuit Breaker: Provides data for quality gates\n*/\n\n\n\nwith trips as (\n    select\n        request_date,\n        city_id,\n        count(*) as trip_count,\n        sum(total_fare_usd) as trip_gross_usd,\n        sum(driver_earnings_usd) as trip_driver_earnings_usd\n    from \"uber_analytics\".\"dev_fact\".\"fct_trips\"\n    where trip_status = 'TRIP_COMPLETED'\n    group by 1, 2\n),\n\npayments as (\n    select\n        payment_timestamp::date as payment_date,\n        trip_id\n    from \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\n    where is_completed = true\n      and is_refund = false\n),\n\npayment_summary as (\n    select\n        p.payment_date,\n        t.city_id,\n        count(distinct p.trip_id) as paid_trip_count,\n        sum(t.total_fare_usd) as paid_gross_usd\n    from payments p\n    inner join \"uber_analytics\".\"dev_fact\".\"fct_trips\" t on p.trip_id = t.trip_id\n    group by 1, 2\n),\n\norphan_payments as (\n    select\n        payment_timestamp::date as payment_date,\n        count(*) as orphan_count\n    from \"uber_analytics\".\"dev_integration\".\"int_payments_reconciled\"\n    where is_orphan_payment = true\n    group by 1\n),\n\nreconciliation as (\n    select\n        coalesce(t.request_date, ps.payment_date) as reconciliation_date,\n        coalesce(t.city_id, ps.city_id) as city_id,\n        \n        -- Trip side\n        coalesce(t.trip_count, 0) as trips_completed,\n        coalesce(t.trip_gross_usd, 0) as trips_gross_usd,\n        coalesce(t.trip_driver_earnings_usd, 0) as trips_driver_earnings_usd,\n        \n        -- Payment side\n        coalesce(ps.paid_trip_count, 0) as trips_paid,\n        coalesce(ps.paid_gross_usd, 0) as payments_gross_usd,\n        \n        -- Orphans\n        coalesce(op.orphan_count, 0) as orphan_payments,\n        \n        -- Reconciliation metrics\n        coalesce(t.trip_count, 0) - coalesce(ps.paid_trip_count, 0) as unpaid_trips,\n        coalesce(t.trip_gross_usd, 0) - coalesce(ps.paid_gross_usd, 0) as revenue_discrepancy_usd,\n        \n        -- Match rates\n        case \n            when coalesce(t.trip_count, 0) > 0 \n            then coalesce(ps.paid_trip_count, 0)::decimal / t.trip_count\n            else null\n        end as payment_match_rate,\n        \n        -- Status\n        case\n            when abs(coalesce(t.trip_count, 0) - coalesce(ps.paid_trip_count, 0)) <= 1 \n                 and abs(coalesce(t.trip_gross_usd, 0) - coalesce(ps.paid_gross_usd, 0)) < 10\n            then 'RECONCILED'\n            when coalesce(t.trip_count, 0) > coalesce(ps.paid_trip_count, 0)\n            then 'TRIPS_UNMATCHED'\n            when coalesce(ps.paid_trip_count, 0) > coalesce(t.trip_count, 0)\n            then 'PAYMENTS_UNMATCHED'\n            else 'DISCREPANCY'\n        end as reconciliation_status\n        \n    from trips t\n    full outer join payment_summary ps \n        on t.request_date = ps.payment_date \n        and t.city_id = ps.city_id\n    left join orphan_payments op on t.request_date = op.payment_date\n)\n\nselect\n    \n    md5(\n        \n            coalesce(cast(reconciliation_date as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(city_id as varchar), '_NULL_')\n            \n        \n    )\n as reconciliation_key,\n    *,\n    \n    -- Circuit breaker flag\n    case \n        when payment_match_rate < 0.99\n        then true\n        else false\n    end as circuit_breaker_triggered,\n    \n    -- Audit\n    current_timestamp as _mart_loaded_at,\n    '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n    \nfrom reconciliation", "relation_name": "\"uber_analytics\".\"dev_mart\".\"mart_reconciliation\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.756590Z", "completed_at": "2026-01-04T19:24:22.760428Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.760972Z", "completed_at": "2026-01-04T19:24:22.760974Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007216930389404297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.mart_revenue_daily", "compiled": true, "compiled_code": "/*\n    Model: mart_revenue_daily\n    Layer: Mart\n    Description: \n        Daily revenue aggregation by city with multi-currency support.\n        All amounts in USD with fiscal calendar attributes.\n    \n    Problems Addressed:\n    - #7 Currency Conversion: Aggregated in USD\n    - #8 Fiscal Calendar: Includes fiscal year/quarter by region\n    - #12 Conditional Aggregations: Excludes cancellations, includes refund adjustments\n*/\n\n\n\nwith trips as (\n    select * from \"uber_analytics\".\"dev_fact\".\"fct_trips\"\n    where trip_status = 'TRIP_COMPLETED'\n),\n\n-- Get city info for fiscal calendar\ncities as (\n    select * from \"uber_analytics\".\"dev_staging\".\"ref_cities\"\n),\n\n-- Get date dimension for fiscal attributes\ndates as (\n    select * from \"uber_analytics\".\"dev_dimension\".\"dim_date\"\n),\n\n-- Daily aggregation by city\ndaily_revenue as (\n    select\n        t.request_date,\n        t.city_id,\n        c.country_code,\n        c.region,\n        \n        -- Trip counts\n        count(*) as completed_trips,\n        count(case when t.surge_multiplier > 1.0 then 1 end) as surge_trips,\n        count(case when t.tips_usd > 0 then 1 end) as tipped_trips,\n        \n        -- Gross revenue (USD)\n        sum(t.total_fare_usd) as gross_bookings_usd,\n        sum(t.base_fare_usd) as base_fare_usd,\n        sum(t.surge_amount_usd) as surge_revenue_usd,\n        sum(t.tips_usd) as tips_usd,\n        sum(t.tolls_usd) as tolls_usd,\n        sum(t.promo_discount_usd) as promo_discounts_usd,\n        \n        -- Driver payouts\n        sum(t.driver_earnings_usd) as driver_payouts_usd,\n        \n        -- Uber net revenue (Gross - Driver payouts)\n        sum(t.total_fare_usd) - sum(t.driver_earnings_usd) as uber_net_revenue_usd,\n        \n        -- Averages\n        avg(t.total_fare_usd) as avg_fare_usd,\n        avg(t.distance_miles) as avg_distance_miles,\n        avg(t.duration_minutes) as avg_duration_minutes,\n        avg(t.driver_rating_received) as avg_driver_rating,\n        \n        -- Late arrivals (data quality indicator)\n        count(case when t.is_late_arrival then 1 end) as late_arrival_trips,\n        \n        -- Last update\n        max(t._fact_loaded_at) as last_updated_at\n        \n    from trips t\n    left join cities c on t.city_id = c.city_id\n    group by 1, 2, 3, 4\n)\n\nselect\n    -- Keys\n    \n    md5(\n        \n            coalesce(cast(request_date as varchar), '_NULL_')\n             || '|' || \n        \n            coalesce(cast(city_id as varchar), '_NULL_')\n            \n        \n    )\n as revenue_key,\n    dr.request_date,\n    dr.city_id,\n    dr.country_code,\n    dr.region,\n    \n    -- Date key for joins\n    to_char(dr.request_date, 'YYYYMMDD')::integer as date_key,\n    \n    -- Calendar attributes\n    d.calendar_year,\n    d.calendar_quarter,\n    d.calendar_month,\n    d.calendar_week,\n    d.day_of_week,\n    d.is_weekend,\n    \n    -- Fiscal attributes (varies by region)\n    case \n        when dr.region in ('EMEA', 'APAC') then d.fiscal_year_uk\n        when dr.region = 'Australia' then d.fiscal_year_au\n        else d.fiscal_year_us\n    end as fiscal_year,\n    \n    case \n        when dr.region in ('EMEA', 'APAC') then d.fiscal_quarter_uk\n        when dr.region = 'Australia' then d.fiscal_quarter_au\n        else d.fiscal_quarter_us\n    end as fiscal_quarter,\n    \n    -- Trip metrics\n    dr.completed_trips,\n    dr.surge_trips,\n    dr.tipped_trips,\n    dr.late_arrival_trips,\n    \n    -- Revenue metrics (USD)\n    dr.gross_bookings_usd,\n    dr.base_fare_usd,\n    dr.surge_revenue_usd,\n    dr.tips_usd,\n    dr.tolls_usd,\n    dr.promo_discounts_usd,\n    dr.driver_payouts_usd,\n    dr.uber_net_revenue_usd,\n    \n    -- Averages\n    dr.avg_fare_usd,\n    dr.avg_distance_miles,\n    dr.avg_duration_minutes,\n    dr.avg_driver_rating,\n    \n    -- Derived ratios\n    dr.surge_trips::decimal / nullif(dr.completed_trips, 0) as surge_trip_rate,\n    dr.tipped_trips::decimal / nullif(dr.completed_trips, 0) as tipped_trip_rate,\n    dr.uber_net_revenue_usd / nullif(dr.gross_bookings_usd, 0) as take_rate,\n    \n    -- Audit\n    dr.last_updated_at,\n    current_timestamp as _mart_loaded_at,\n    '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n    \nfrom daily_revenue dr\nleft join dates d on dr.request_date = d.full_date", "relation_name": "\"uber_analytics\".\"dev_mart\".\"mart_revenue_daily\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.759143Z", "completed_at": "2026-01-04T19:24:22.761321Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.763297Z", "completed_at": "2026-01-04T19:24:22.763299Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.005213022232055664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_trips_total_fare_usd.e628f7c959", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trips\"\nwhere total_fare_usd is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_trips_total_fare_usd\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.761883Z", "completed_at": "2026-01-04T19:24:22.764276Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.767430Z", "completed_at": "2026-01-04T19:24:22.767439Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.006910085678100586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_trips_trip_id.df65bf8c1d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trips\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_trips_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.764610Z", "completed_at": "2026-01-04T19:24:22.769624Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.770188Z", "completed_at": "2026-01-04T19:24:22.770193Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.006697893142700195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_fct_trips_trip_id.9b74cb6aab", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trip_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trips\"\nwhere trip_id is not null\ngroup by trip_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_fct_trips_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.765937Z", "completed_at": "2026-01-04T19:24:22.769815Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.770434Z", "completed_at": "2026-01-04T19:24:22.770437Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.006797075271606445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_trip_accumulating_current_milestone.c8206b8e36", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trip_accumulating\"\nwhere current_milestone is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_trip_accumulating_current_milestone\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.768282Z", "completed_at": "2026-01-04T19:24:22.770852Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.774176Z", "completed_at": "2026-01-04T19:24:22.774180Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009793996810913086, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_trip_accumulating_trip_id.7350415991", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trip_accumulating\"\nwhere trip_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_trip_accumulating_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.771561Z", "completed_at": "2026-01-04T19:24:22.775234Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.777199Z", "completed_at": "2026-01-04T19:24:22.777203Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0072481632232666016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_fct_trip_accumulating_trip_id.9de4e980b8", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    trip_id as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_fact\".\"fct_trip_accumulating\"\nwhere trip_id is not null\ngroup by trip_id\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_fct_trip_accumulating_trip_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.775685Z", "completed_at": "2026-01-04T19:24:22.781251Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.781840Z", "completed_at": "2026-01-04T19:24:22.781845Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0074291229248046875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.uber_analytics.mart_driver_performance", "compiled": true, "compiled_code": "/*\n    Model: mart_driver_performance\n    Layer: Mart\n    Description: \n        Driver performance metrics including earnings, ratings, and utilization.\n        Supports driver segmentation and performance management.\n    \n    Problems Addressed:\n    - #9 Hierarchical Data: Manager chain analysis\n    - #32 Cohort Analysis: Driver signup cohorts\n*/\n\n\n\nwith earnings as (\n    select * from \"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"\n),\n\ndrivers as (\n    select * from \"uber_analytics\".\"dev_dimension\".\"dim_driver\"\n    where is_current = true\n),\n\n-- Lifetime aggregation\nlifetime_stats as (\n    select\n        driver_id,\n        sum(total_trips) as lifetime_trips,\n        sum(total_earnings_usd) as lifetime_earnings_usd,\n        sum(total_tips_usd) as lifetime_tips_usd,\n        avg(avg_rating_received) as avg_rating,\n        min(payout_week_start) as first_trip_week,\n        max(payout_week_start) as last_trip_week,\n        count(distinct payout_week_start) as active_weeks\n    from earnings\n    group by driver_id\n),\n\n-- Recent period (last 4 weeks)\nrecent_stats as (\n    select\n        driver_id,\n        sum(total_trips) as recent_trips,\n        sum(total_earnings_usd) as recent_earnings_usd,\n        avg(earnings_per_hour_usd) as recent_earnings_per_hour,\n        avg(avg_rating_received) as recent_avg_rating\n    from earnings\n    where payout_week_start >= current_date - interval '28 days'\n    group by driver_id\n)\n\nselect\n    -- Keys\n    d.driver_key,\n    d.driver_id,\n    d.city_id,\n    \n    -- Driver attributes\n    d.driver_status,\n    d.current_rating,\n    d.signup_date,\n    d.background_check_status,\n    d.is_active,\n    \n    -- Signup cohort (for cohort analysis)\n    date_trunc('month', d.signup_date)::date as signup_cohort_month,\n    date_trunc('quarter', d.signup_date)::date as signup_cohort_quarter,\n    \n    -- Tenure\n    (current_date - d.signup_date) as days_since_signup,\n    (current_date - d.signup_date) / 30 as months_since_signup,\n    \n    -- Lifetime metrics\n    coalesce(l.lifetime_trips, 0) as lifetime_trips,\n    coalesce(l.lifetime_earnings_usd, 0) as lifetime_earnings_usd,\n    coalesce(l.lifetime_tips_usd, 0) as lifetime_tips_usd,\n    coalesce(l.avg_rating, 0) as lifetime_avg_rating,\n    l.first_trip_week,\n    l.last_trip_week,\n    coalesce(l.active_weeks, 0) as total_active_weeks,\n    \n    -- Recent metrics (last 4 weeks)\n    coalesce(r.recent_trips, 0) as recent_trips,\n    coalesce(r.recent_earnings_usd, 0) as recent_earnings_usd,\n    coalesce(r.recent_earnings_per_hour, 0) as recent_earnings_per_hour,\n    coalesce(r.recent_avg_rating, 0) as recent_avg_rating,\n    \n    -- Engagement\n    case \n        when l.last_trip_week >= current_date - interval '7 days' then 'ACTIVE'\n        when l.last_trip_week >= current_date - interval '30 days' then 'RECENT'\n        when l.last_trip_week >= current_date - interval '90 days' then 'AT_RISK'\n        else 'CHURNED'\n    end as engagement_status,\n    \n    current_date - l.last_trip_week as days_since_last_trip,\n    \n    -- Performance tier\n    case\n        when l.lifetime_trips >= 1000 and l.avg_rating >= 4.9 then 'PLATINUM'\n        when l.lifetime_trips >= 500 and l.avg_rating >= 4.8 then 'GOLD'\n        when l.lifetime_trips >= 100 and l.avg_rating >= 4.7 then 'SILVER'\n        else 'BRONZE'\n    end as performance_tier,\n    \n    -- Derived metrics\n    coalesce(l.lifetime_earnings_usd / nullif(l.lifetime_trips, 0), 0) as avg_earnings_per_trip,\n    coalesce(l.lifetime_tips_usd / nullif(l.lifetime_earnings_usd, 0), 0) as tip_rate,\n    \n    -- Audit\n    current_timestamp as _mart_loaded_at,\n    '402658b7-059e-4de5-83c3-55909b7e2657' as _invocation_id\n    \nfrom drivers d\nleft join lifetime_stats l on d.driver_id = l.driver_id\nleft join recent_stats r on d.driver_id = r.driver_id", "relation_name": "\"uber_analytics\".\"dev_mart\".\"mart_driver_performance\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.777444Z", "completed_at": "2026-01-04T19:24:22.781624Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.782370Z", "completed_at": "2026-01-04T19:24:22.782373Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007786989212036133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_driver_earnings_driver_id.1912e769b6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"\nwhere driver_id is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_driver_earnings_driver_id\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.779754Z", "completed_at": "2026-01-04T19:24:22.782588Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.784781Z", "completed_at": "2026-01-04T19:24:22.784786Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.009280920028686523, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_fct_driver_earnings_earnings_key.8f2ad181dd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"\nwhere earnings_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_fct_driver_earnings_earnings_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.783036Z", "completed_at": "2026-01-04T19:24:22.785771Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.788218Z", "completed_at": "2026-01-04T19:24:22.788222Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0068111419677734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_fct_driver_earnings_earnings_key.1fabf08070", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    earnings_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_fact\".\"fct_driver_earnings\"\nwhere earnings_key is not null\ngroup by earnings_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_fct_driver_earnings_earnings_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.786212Z", "completed_at": "2026-01-04T19:24:22.791594Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.792127Z", "completed_at": "2026-01-04T19:24:22.792130Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.007085084915161133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.accepted_values_mart_reconciliation_reconciliation_status__RECONCILED__TRIPS_UNMATCHED__PAYMENTS_UNMATCHED__DISCREPANCY.9cb3ebf8b5", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        reconciliation_status as value_field,\n        count(*) as n_records\n\n    from \"uber_analytics\".\"dev_mart\".\"mart_reconciliation\"\n    group by reconciliation_status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'RECONCILED','TRIPS_UNMATCHED','PAYMENTS_UNMATCHED','DISCREPANCY'\n)\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"accepted_values_mart_reconcili_f2ceff9666384c2932c115fc750e0009\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.788447Z", "completed_at": "2026-01-04T19:24:22.791927Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.792640Z", "completed_at": "2026-01-04T19:24:22.792642Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.007379055023193359, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_mart_reconciliation_reconciliation_key.0d7e6363c3", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_mart\".\"mart_reconciliation\"\nwhere reconciliation_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_mart_reconciliation_reconciliation_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.790133Z", "completed_at": "2026-01-04T19:24:22.792499Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.794390Z", "completed_at": "2026-01-04T19:24:22.794395Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.008355140686035156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_mart_reconciliation_reconciliation_key.5622923bad", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    reconciliation_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_mart\".\"mart_reconciliation\"\nwhere reconciliation_key is not null\ngroup by reconciliation_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_mart_reconciliation_reconciliation_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.793014Z", "completed_at": "2026-01-04T19:24:22.795331Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.795872Z", "completed_at": "2026-01-04T19:24:22.795876Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.004142045974731445, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_mart_revenue_daily_revenue_key.35d7995aea", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_mart\".\"mart_revenue_daily\"\nwhere revenue_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_mart_revenue_daily_revenue_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.796091Z", "completed_at": "2026-01-04T19:24:22.803505Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.804019Z", "completed_at": "2026-01-04T19:24:22.804022Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.009222984313964844, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_mart_revenue_daily_revenue_key.92ab0bf130", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    revenue_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_mart\".\"mart_revenue_daily\"\nwhere revenue_key is not null\ngroup by revenue_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_mart_revenue_daily_revenue_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.797807Z", "completed_at": "2026-01-04T19:24:22.803839Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.805735Z", "completed_at": "2026-01-04T19:24:22.805738Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.010577201843261719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.accepted_values_mart_driver_performance_engagement_status__ACTIVE__RECENT__AT_RISK__CHURNED.7a48a7c4ab", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        engagement_status as value_field,\n        count(*) as n_records\n\n    from \"uber_analytics\".\"dev_mart\".\"mart_driver_performance\"\n    group by engagement_status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'ACTIVE','RECENT','AT_RISK','CHURNED'\n)\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"accepted_values_mart_driver_pe_bf682021935775df638e3743e5cd1dd4\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.801133Z", "completed_at": "2026-01-04T19:24:22.804226Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.806150Z", "completed_at": "2026-01-04T19:24:22.806153Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.010576963424682617, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.accepted_values_mart_driver_performance_performance_tier__PLATINUM__GOLD__SILVER__BRONZE.4bc72315e6", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        performance_tier as value_field,\n        count(*) as n_records\n\n    from \"uber_analytics\".\"dev_mart\".\"mart_driver_performance\"\n    group by performance_tier\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'PLATINUM','GOLD','SILVER','BRONZE'\n)\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"accepted_values_mart_driver_pe_0881469bdcbfd8a7524ef63b7e9bf927\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.804390Z", "completed_at": "2026-01-04T19:24:22.806619Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.806925Z", "completed_at": "2026-01-04T19:24:22.806928Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0035903453826904297, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.not_null_mart_driver_performance_driver_key.95024546f9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect *\nfrom \"uber_analytics\".\"dev_mart\".\"mart_driver_performance\"\nwhere driver_key is null\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"not_null_mart_driver_performance_driver_key\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-04T19:24:22.807142Z", "completed_at": "2026-01-04T19:24:22.808447Z"}, {"name": "execute", "started_at": "2026-01-04T19:24:22.808588Z", "completed_at": "2026-01-04T19:24:22.808590Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.0021359920501708984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.uber_analytics.unique_mart_driver_performance_driver_key.c548e651a5", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    driver_key as unique_field,\n    count(*) as n_records\n\nfrom \"uber_analytics\".\"dev_mart\".\"mart_driver_performance\"\nwhere driver_key is not null\ngroup by driver_key\nhaving count(*) > 1\n\n\n", "relation_name": "\"uber_analytics\".\"dev_quality\".\"unique_mart_driver_performance_driver_key\"", "batch_results": null}], "elapsed_time": 0.37057018280029297, "args": {"send_anonymous_usage_stats": true, "cache_selected_only": false, "state_modified_compare_more_unrendered_values": false, "validate_macro_args": false, "log_level_file": "debug", "strict_mode": false, "indirect_selection": "eager", "require_explicit_package_overrides_for_builtin_materializations": true, "use_colors_file": true, "write_json": true, "invocation_command": "dbt docs generate", "log_path": "/Applications/MAMP/htdocs/DataEngineeringAcademy/DBT+Airflow/dbt/uber_analytics/logs", "require_unique_project_resource_names": false, "defer": false, "select": [], "state_modified_compare_vars": false, "static": false, "which": "generate", "print": true, "skip_nodes_if_on_run_start_fails": false, "macro_debugging": false, "printer_width": 80, "partial_parse": true, "favor_state": false, "quiet": false, "log_level": "info", "require_batched_execution_for_custom_microbatch_strategy": false, "upload_to_artifacts_ingest_api": false, "log_format": "default", "empty_catalog": false, "partial_parse_file_diff": true, "static_parser": true, "require_all_warnings_handled_by_warn_error": false, "populate_cache": true, "show_resource_report": false, "show_all_deprecations": false, "profiles_dir": "/Users/bhavyagada/.dbt", "require_resource_names_without_spaces": true, "introspect": true, "vars": {}, "log_file_max_bytes": 10485760, "source_freshness_run_project_hooks": true, "require_generic_test_arguments_property": true, "use_colors": true, "version_check": true, "compile": true, "use_fast_test_edges": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "require_ref_searches_node_package_before_root": false, "project_dir": "/Applications/MAMP/htdocs/DataEngineeringAcademy/DBT+Airflow/dbt/uber_analytics", "exclude": [], "log_format_file": "debug", "require_yaml_configuration_for_mf_time_spines": false, "require_nested_cumulative_type_params": false}}